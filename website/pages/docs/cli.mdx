# Herramientas CLI

Fox Framework incluye un potente sistema de l√≠nea de comandos (CLI) que facilita la creaci√≥n, desarrollo y mantenimiento de aplicaciones. Esta herramienta est√° dise√±ada para incrementar la productividad del desarrollador, automatizar tareas repetitivas y mantener la consistencia del c√≥digo.

## Caracter√≠sticas Principales

- **Scaffolding** de proyectos y componentes
- **Generaci√≥n autom√°tica** de c√≥digo (controladores, servicios, etc.)
- **Migraci√≥n** y gesti√≥n de bases de datos
- **Testing** y diagn√≥stico de aplicaciones
- **Despliegue** y gesti√≥n de entornos
- **Extensible** mediante plugins personalizados
- **Interactivo** con prompts y asistentes
- **Documentaci√≥n** integrada y contextual

## Instalaci√≥n

La CLI se distribuye dentro del paquete principal.

```bash
# (Opcional) Instalaci√≥n global
npm install -g @foxframework/core

# Uso sin instalaci√≥n global
npx -p @foxframework/core tsfox --help
```

## Comandos B√°sicos

### Crear un Nuevo Proyecto

```bash
# Proyecto b√°sico
npx -p @foxframework/core tsfox new my-project

# Selecci√≥n de plantilla (basic|api|full)
npx -p @foxframework/core tsfox new my-project --template api
```

Opciones actuales:
- `--template` (basic | api | full)

### Generar Componentes

```bash
# Controlador (implementado)
npx -p @foxframework/core tsfox generate controller Users --crud --service --test

# Service / Model / Middleware (placeholders iniciales)
npx -p @foxframework/core tsfox generate service Billing
npx -p @foxframework/core tsfox generate model User
npx -p @foxframework/core tsfox generate middleware Auth
```

Estado actual:
- controller ‚úÖ generado con archivos y opciones (--crud, --service, --test, --validation, --auth, --model, --update-routes)
- service üöß placeholder
- model üöß placeholder
- middleware üöß placeholder

Roadmap (no disponibles a√∫n): repository, validator, interface, test, view.

### Ejecutar la Aplicaci√≥n

Actualmente la CLI no expone `start` propio; usa scripts de npm:

```bash
npm run dev   # desarrollo
npm start     # producci√≥n (si est√° configurado)
```

### Administrar el Proyecto

Por ahora administraci√≥n manual / scripts npm. Comandos planeados: info, update, clean (roadmap).

## Generaci√≥n de C√≥digo

### Controladores

```bash
# Generar controlador b√°sico
// NO disponible: ejemplo hist√≥rico (reemplazado por tsfox generate controller)

# Controlador CRUD completo
fox g controller UserController --resource --model=User

# Controlador con opciones personalizadas
fox g controller PaymentController --methods=process,verify,refund
```

Esto generar√° archivos como:

```
src/controllers/user.controller.ts
src/controllers/__tests__/user.controller.test.ts
```

Ejemplo de controlador generado:

```typescript
import { Controller, Get, Post, Put, Delete, HttpContext } from 'fox-framework/core';
import { UserService } from '../services/user.service';

@Controller('/users')
export class UserController {
  constructor(private userService: UserService) {}

  @Get('/')
  async getAll(ctx: HttpContext) {
    const users = await this.userService.findAll(ctx.query);
    return users;
  }

  @Get('/:id')
  async getOne(ctx: HttpContext) {
    const user = await this.userService.findById(ctx.params.id);
    if (!user) {
      ctx.status = 404;
      return { error: 'User not found' };
    }
    return user;
  }

  @Post('/')
  async create(ctx: HttpContext) {
    const user = await this.userService.create(ctx.body);
    ctx.status = 201;
    return user;
  }

  @Put('/:id')
  async update(ctx: HttpContext) {
    const updated = await this.userService.update(ctx.params.id, ctx.body);
    return updated;
  }

  @Delete('/:id')
  async delete(ctx: HttpContext) {
    await this.userService.delete(ctx.params.id);
    ctx.status = 204;
    return null;
  }
}
```

### Servicios

```bash
# Generar servicio b√°sico
// Placeholder ‚Äì usar: npx -p @foxframework/core tsfox generate service UserService

# Servicio con modelo e inyecci√≥n
fox g service PaymentService --model=Payment --inject=PaymentGateway,NotificationService
```

Ejemplo de servicio generado:

```typescript
import { Injectable } from 'fox-framework/core';
import { User } from '../models/user.model';
import { UserRepository } from '../repositories/user.repository';

@Injectable()
export class UserService {
  constructor(private userRepository: UserRepository) {}

  async findAll(filters = {}) {
    return this.userRepository.findAll(filters);
  }

  async findById(id: string) {
    return this.userRepository.findById(id);
  }

  async create(userData: Partial<User>) {
    // Validaci√≥n y l√≥gica de negocio aqu√≠
    return this.userRepository.create(userData);
  }

  async update(id: string, userData: Partial<User>) {
    return this.userRepository.update(id, userData);
  }

  async delete(id: string) {
    return this.userRepository.delete(id);
  }
}
```

### Middleware

```bash
# Generar middleware b√°sico
// Placeholder ‚Äì usar: npx -p @foxframework/core tsfox generate middleware AuthMiddleware

# Middleware con opciones
fox g middleware RateLimiterMiddleware --config=rate-limiter
```

Ejemplo de middleware generado:

```typescript
import { Middleware, HttpContext, NextFunction } from 'fox-framework/core';

@Middleware()
export class AuthMiddleware {
  async handle(ctx: HttpContext, next: NextFunction) {
    // Obtener y verificar token
    const token = ctx.headers.authorization?.split('Bearer ')[1];
    
    if (!token) {
      ctx.status = 401;
      return { error: 'Authorization token required' };
    }
    
    try {
      // Verificar token y extraer informaci√≥n del usuario
      const user = await this.verifyToken(token);
      
      // A√±adir usuario al contexto
      ctx.auth = { user };
      
      // Continuar con la cadena de middleware
      return next();
    } catch (error) {
      ctx.status = 401;
      return { error: 'Invalid token' };
    }
  }
  
  private async verifyToken(token: string) {
    // Implementar verificaci√≥n de token
    // ...
    return { id: '123', role: 'user' };
  }
}
```

### Modelos

```bash
# Generar modelo b√°sico
fox g model User

# Modelo con atributos
fox g model Product --attrs="name:string,price:number,description:string"

# Modelo con relaciones
fox g model Order --attrs="total:number,status:string" --relations="user:belongsTo,items:hasMany"
```

Ejemplo de modelo generado:

```typescript
import { Model, Field, Required, Min, Max, HasMany } from 'fox-framework/db';

@Model('users')
export class User {
  @Field({ primary: true })
  id: string;
  
  @Field()
  @Required()
  name: string;
  
  @Field()
  @Required()
  email: string;
  
  @Field({ secure: true })
  @Required()
  password: string;
  
  @Field()
  role: string = 'user';
  
  @Field()
  createdAt: Date = new Date();
  
  @Field()
  updatedAt: Date = new Date();
  
  @HasMany(() => Order)
  orders: Order[];
}
```

### Proyectos Completos

```bash
# Crear una API REST completa
fox new my-api --template api

# Crear una aplicaci√≥n web con frontend
fox new my-web-app --template web

# Crear una arquitectura de microservicios
fox new my-system --template microservices
```

## Gesti√≥n de Base de Datos

### Migraciones

```bash
# Crear una nueva migraci√≥n
fox g migration CreateUsersTable

# Ejecutar migraciones pendientes
fox db:migrate

# Revertir √∫ltima migraci√≥n
fox db:rollback

# Ver estado de migraciones
fox db:status
```

Ejemplo de una migraci√≥n generada:

```typescript
import { Migration } from 'fox-framework/db';

export default class CreateUsersTable implements Migration {
  async up(db) {
    await db.schema.createTable('users', table => {
      table.uuid('id').primary();
      table.string('name').notNullable();
      table.string('email').notNullable().unique();
      table.string('password').notNullable();
      table.string('role').defaultTo('user');
      table.timestamps(true, true);
    });
  }

  async down(db) {
    await db.schema.dropTable('users');
  }
}
```

### Seeders

```bash
# Crear un seeder
fox g seeder UsersSeeder

# Ejecutar todos los seeders
fox db:seed

# Ejecutar un seeder espec√≠fico
fox db:seed UsersSeeder
```

Ejemplo de seeder generado:

```typescript
import { Seeder } from 'fox-framework/db';
import { User } from '../models/user.model';

export default class UsersSeeder implements Seeder {
  async run(db) {
    // Crear usuarios de ejemplo
    await db.table('users').insert([
      {
        id: '550e8400-e29b-41d4-a716-446655440000',
        name: 'Admin User',
        email: 'admin@example.com',
        password: await this.hashPassword('admin123'),
        role: 'admin'
      },
      {
        id: '550e8400-e29b-41d4-a716-446655440001',
        name: 'Test User',
        email: 'user@example.com',
        password: await this.hashPassword('user123'),
        role: 'user'
      }
    ]);
  }
  
  private async hashPassword(password: string): Promise<string> {
    // Implementar hash de contrase√±a
    return password; // En un caso real, hacer hash
  }
}
```

## Testing

### Ejecutar Tests

```bash
# Ejecutar todos los tests
fox test

# Ejecutar tests con cobertura
fox test --coverage

# Ejecutar tests espec√≠ficos
fox test --pattern="user.*"

# Ejecutar en modo watch
fox test --watch
```

### Generar Tests

```bash
# Generar test unitario
fox g test unit UserService

# Generar test de integraci√≥n
fox g test integration UserController

# Generar test end-to-end
fox g test e2e UserFlow
```

Ejemplo de test unitario generado:

```typescript
import { describe, it, expect, beforeEach, mock } from 'fox-framework/testing';
import { UserService } from '../../services/user.service';
import { UserRepository } from '../../repositories/user.repository';

describe('UserService', () => {
  let userService: UserService;
  let userRepository: jest.Mocked<UserRepository>;
  
  beforeEach(() => {
    // Crear mock del repositorio
    userRepository = {
      findAll: jest.fn(),
      findById: jest.fn(),
      create: jest.fn(),
      update: jest.fn(),
      delete: jest.fn()
    } as any;
    
    // Crear instancia de servicio con dependencia mockeada
    userService = new UserService(userRepository);
  });
  
  describe('findAll', () => {
    it('should return all users', async () => {
      // Arrange
      const mockUsers = [
        { id: '1', name: 'User 1' },
        { id: '2', name: 'User 2' }
      ];
      userRepository.findAll.mockResolvedValue(mockUsers);
      
      // Act
      const result = await userService.findAll();
      
      // Assert
      expect(userRepository.findAll).toHaveBeenCalled();
      expect(result).toEqual(mockUsers);
    });
  });
  
  describe('create', () => {
    it('should create a user', async () => {
      // Arrange
      const userData = { name: 'New User', email: 'new@example.com' };
      const createdUser = { id: '3', ...userData };
      userRepository.create.mockResolvedValue(createdUser);
      
      // Act
      const result = await userService.create(userData);
      
      // Assert
      expect(userRepository.create).toHaveBeenCalledWith(userData);
      expect(result).toEqual(createdUser);
    });
  });
  
  // M√°s tests...
});
```

## Despliegue y Entornos

### Configuraci√≥n de Entornos

```bash
# Configurar un nuevo entorno
fox env:setup production

# Generar archivos .env para distintos entornos
fox env:create --template

# Verificar configuraci√≥n de entorno
fox env:check production

# Listar variables de entorno
fox env:list
```

### Despliegue

```bash
# Preparar para despliegue
fox deploy:build --env=production

# Desplegar a entorno espec√≠fico
fox deploy --target=server1 --env=production

# Configurar opciones de despliegue
fox deploy:config
```

## Extensiones y Personalizaci√≥n

### Crear Plugin

```bash
# Generar estructura b√°sica de plugin
fox plugin:create fox-plugin-stripe

# Instalar plugin existente
fox plugin:install fox-plugin-stripe
```

Estructura t√≠pica de un plugin:

```
fox-plugin-stripe/
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ types.ts
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stripe.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ controllers/
‚îÇ       ‚îî‚îÄ‚îÄ payment.controller.ts
‚îî‚îÄ‚îÄ templates/
    ‚îî‚îÄ‚îÄ config.template.ts
```

### Crear Comandos Personalizados

Puedes extender la CLI con tus propios comandos creando un archivo `.foxrc.js` en la ra√≠z de tu proyecto:

```javascript
// .foxrc.js
module.exports = {
  commands: {
    // Comando personalizado
    'clean:logs': {
      description: 'Eliminar archivos de log antiguos',
      action: async (args) => {
        const { exec } = require('child_process');
        const days = args.days || 7;
        
        console.log(`Eliminando logs de m√°s de ${days} d√≠as...`);
        
        exec(`find ./logs -type f -name "*.log" -mtime +${days} -delete`, 
          (error, stdout, stderr) => {
            if (error) {
              console.error(`Error: ${error.message}`);
              return;
            }
            console.log('Logs antiguos eliminados correctamente');
          }
        );
      },
      options: [
        { name: 'days', type: 'number', description: 'D√≠as para considerar un log como antiguo' }
      ]
    }
  },
  
  // Hooks para eventos del ciclo de vida
  hooks: {
    'pre-build': () => console.log('Ejecutando tareas antes del build...'),
    'post-build': () => console.log('Build completado, ejecutando tareas finales...')
  },
  
  // Plantillas personalizadas
  templates: {
    'custom-controller': {
      description: 'Controlador con estructura personalizada',
      files: {
        'src/controllers/{name}.controller.ts': require.resolve('./templates/custom-controller.template.ts')
      }
    }
  }
};
```

Para usar este comando personalizado:

```bash
fox clean:logs --days=30
```

### Configurar Defaults

Tambi√©n puedes configurar opciones por defecto en `.foxrc.js`:

```javascript
module.exports = {
  // Configuraci√≥n global
  config: {
    // Estructura de directorios personalizada
    paths: {
      controllers: 'src/api/controllers',
      services: 'src/services',
      models: 'src/domain/models',
      repositories: 'src/infrastructure/repositories'
    },
    
    // Opciones por defecto para generadores
    generators: {
      controller: {
        template: 'custom-controller',
        includeSpec: true
      },
      model: {
        baseClass: 'BaseModel',
        timestamps: true
      }
    }
  }
};
```

## Interacci√≥n y UX

### Modo Interactivo

```bash
# Iniciar CLI en modo interactivo
fox interactive

# O la versi√≥n corta
fox i
```

Esto iniciar√° una interfaz interactiva con:

- Historial de comandos
- Autocompletado
- Sugerencias contextuales
- Navegaci√≥n de opciones

### Asistentes y Prompts

La CLI utiliza prompts interactivos para guiarte en la creaci√≥n de componentes:

```bash
fox create
```

Mostrar√° un asistente paso a paso:

1. Selecci√≥n del tipo de componente
2. Configuraci√≥n de opciones
3. Confirmaci√≥n y previsualizaci√≥n
4. Generaci√≥n de archivos

## Diagn√≥stico y Soluci√≥n de Problemas

### Informaci√≥n del Sistema

```bash
# Ver informaci√≥n detallada del proyecto y entorno
fox info --detailed

# Verificar si hay problemas conocidos
fox doctor
```

Esto mostrar√°:

- Versiones de dependencias
- Configuraci√≥n del entorno
- Problemas potenciales
- Sugerencias de optimizaci√≥n

### Logs y Depuraci√≥n

```bash
# Ver logs de la CLI
fox logs

# Ejecutar en modo verbose
fox [comando] --verbose

# Depurar problemas
fox debug [problema]
```

## Comandos Adicionales

### Gesti√≥n de M√≥dulos

```bash
# Generar un nuevo m√≥dulo (agrupaci√≥n l√≥gica)
fox g module UserManagement

# Listar m√≥dulos
fox module:list

# Describir estructura de un m√≥dulo
fox module:describe UserManagement
```

### Documentaci√≥n

```bash
# Generar documentaci√≥n autom√°tica
fox docs:generate

# Visualizar documentaci√≥n localmente
fox docs:serve

# Verificar cobertura de documentaci√≥n
fox docs:coverage
```

### An√°lisis de C√≥digo

```bash
# Ejecutar linter
fox lint

# Arreglar problemas autom√°ticamente
fox lint --fix

# Analizar estructura y dependencias
fox analyze

# Verificar cumplimiento de mejores pr√°cticas
fox quality
```

## Integraci√≥n con IDEs

Fox CLI proporciona integraci√≥n con los principales IDEs:

### Visual Studio Code

Instala la extensi√≥n "Fox Framework Tools" para:

- Snippets y autocompletado
- Comandos integrados en la paleta
- Diagn√≥stico en tiempo real
- Vista de estructura del proyecto

### WebStorm/IntelliJ

Configura los scripts externos en tu IDE:

1. Settings ‚Üí Tools ‚Üí External Tools
2. A√±adir comandos fox como herramientas externas
3. Asignar atajos de teclado

## Buenas Pr√°cticas

### Estructura del Proyecto

La CLI promueve una estructura consistente:

```
src/
‚îú‚îÄ‚îÄ controllers/      # Controladores HTTP
‚îú‚îÄ‚îÄ services/         # L√≥gica de negocio
‚îú‚îÄ‚îÄ models/           # Modelos de datos
‚îú‚îÄ‚îÄ repositories/     # Acceso a datos
‚îú‚îÄ‚îÄ middleware/       # Middleware HTTP
‚îú‚îÄ‚îÄ validators/       # Validaci√≥n de datos
‚îú‚îÄ‚îÄ config/           # Configuraci√≥n
‚îú‚îÄ‚îÄ utils/            # Utilidades generales
‚îî‚îÄ‚îÄ types/            # Definiciones TypeScript
```

### Generaci√≥n vs Modificaci√≥n

- Usa `--dry-run` para previsualizar cambios
- Preferiblemente genera c√≥digo nuevo en vez de modificar existente
- Para modificaciones estructurales, usa `refactor` en lugar de `generate`

### Trabajo en Equipo

- Comit√© los archivos `.foxrc.js` para compartir configuraci√≥n
- Documenta comandos personalizados
- Usa `--template` para mantener consistencia en el equipo

## Conclusi√≥n

La herramienta CLI de Fox Framework es un componente fundamental del ecosistema, dise√±ada para acelerar el desarrollo y mantener la consistencia del c√≥digo. Con funcionalidades para scaffolding, generaci√≥n de c√≥digo, testing, despliegue y m√°s, la CLI te permite centrarte en construir tu aplicaci√≥n en lugar de en tareas repetitivas.

Las caracter√≠sticas de personalizaci√≥n y extensi√≥n permiten adaptar la herramienta a las necesidades espec√≠ficas de cada equipo y proyecto, mientras que la integraci√≥n con IDEs y otras herramientas la hacen parte natural del flujo de trabajo del desarrollador.

Para obtener ayuda detallada sobre cualquier comando, utiliza:

```bash
fox help [comando]
```

Para mantenerte al d√≠a con las √∫ltimas actualizaciones y caracter√≠sticas:

```bash
fox update
fox changelog
```
